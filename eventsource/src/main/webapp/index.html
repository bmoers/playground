<!doctype html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta charset="utf-8">
<title>EventSource</title>
<link rel="stylesheet" href="http://cdn.sencha.com/ext-4.1.1-gpl/resources/css/ext-all.css">
<script src="http://cdn.sencha.com/ext-4.1.1-gpl/ext-all.js"></script>
<script>
Ext.onReady(function() {

	var panel = Ext.create('Ext.panel.Panel', {
		title: 'EventSource',
		xtype: 'panel',
		width: 400,
		height: 300,
		renderTo: Ext.getBody(),
		bodyPadding: 5,
		tpl: '<p>{data}</p>',
		tplWriteMode: 'insertFirst',
		autoScroll: true,
		
		dockedItems: [{
	        xtype: 'toolbar',
	        dock: 'top',
	        items: [{
	            text: 'Start',
	            itemId: 'startButton',
	            handler: startPolling
	        }, {
	        	text: 'Stop',
	        	itemId: 'stopButton',
	        	disabled: true,
	        	handler: stopPolling
	        }]
	    }]
	});

	var source;
	
	function startPolling() {
		panel.down('#stopButton').enable();
		panel.down('#startButton').disable();
		source = new EventSource('date');
		source.addEventListener('message', function(e) {
			panel.update({
				data: e.data
			});
		}, false);
	}
	
	function stopPolling() {
		panel.down('#stopButton').disable();
		panel.down('#startButton').enable();
		if (source) {
			source.close();
		}
	}

});
</script>

</head>
<body></body>
</html>